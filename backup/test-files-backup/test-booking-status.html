<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¢„çº¦çŠ¶æ€æ›´æ–°æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-confirmed { background: #d4edda; color: #155724; }
        .status-processing { background: #cce5ff; color: #004085; }
        .status-completed { background: #d1ecf1; color: #0c5460; }
        .status-cancelled { background: #f8d7da; color: #721c24; }
        
        .btn {
            padding: 6px 12px;
            margin: 2px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-info { background: #17a2b8; color: white; }
        
        .btn:hover { opacity: 0.8; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        .log-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
        .warning { color: #ffc107; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ§ª é¢„çº¦çŠ¶æ€æ›´æ–°åŠŸèƒ½æµ‹è¯•</h1>
        <p>ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®æµ‹è¯•è®¢å•çŠ¶æ€æ›´æ–°åŠŸèƒ½</p>
        <div>
            <button class="btn btn-info" onclick="window.open('http://localhost:3001/admin', '_blank')">
                ğŸš€ æ‰“å¼€ç®¡ç†åå°
            </button>
            <button class="btn btn-primary" onclick="resetTestData()">
                ğŸ”„ é‡ç½®æµ‹è¯•æ•°æ®
            </button>
            <button class="btn btn-warning" onclick="clearLog()">
                ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—
            </button>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ“‹ å½“å‰æµ‹è¯•æ•°æ®</h2>
        <table id="orderTable">
            <thead>
                <tr>
                    <th>è®¢å•ID</th>
                    <th>å®¢æˆ·å§“å</th>
                    <th>è”ç³»ç”µè¯</th>
                    <th>æœåŠ¡é¡¹ç›®</th>
                    <th>é¢„çº¦æ—¶é—´</th>
                    <th>ä»·æ ¼</th>
                    <th>çŠ¶æ€</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody id="orderTableBody">
                <!-- æ•°æ®å°†é€šè¿‡JavaScriptå¡«å…… -->
            </tbody>
        </table>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š æµ‹è¯•è¯´æ˜</h2>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
                <h3>ğŸ”„ çŠ¶æ€æµè½¬è§„åˆ™</h3>
                <ul>
                    <li><strong>å¾…ç¡®è®¤ â†’ å·²ç¡®è®¤:</strong> ç‚¹å‡»"ç¡®è®¤"æŒ‰é’®</li>
                    <li><strong>å·²ç¡®è®¤ â†’ è¿›è¡Œä¸­:</strong> ç‚¹å‡»"å¼€å§‹æœåŠ¡"æŒ‰é’®</li>
                    <li><strong>è¿›è¡Œä¸­ â†’ å·²å®Œæˆ:</strong> ç‚¹å‡»"å®ŒæˆæœåŠ¡"æŒ‰é’®</li>
                    <li><strong>å¾…ç¡®è®¤/å·²ç¡®è®¤ â†’ å·²å–æ¶ˆ:</strong> ç‚¹å‡»"å–æ¶ˆ"æŒ‰é’®</li>
                </ul>
            </div>
            <div>
                <h3>ğŸ§ª æµ‹è¯•æ­¥éª¤</h3>
                <ol>
                    <li>è§‚å¯Ÿä¸Šæ–¹è¡¨æ ¼ä¸­çš„è®¢å•çŠ¶æ€</li>
                    <li>ç‚¹å‡»ç›¸åº”çš„æ“ä½œæŒ‰é’®</li>
                    <li>æŸ¥çœ‹çŠ¶æ€æ˜¯å¦ç«‹å³æ›´æ–°</li>
                    <li>æ£€æŸ¥ä¸‹æ–¹çš„æ“ä½œæ—¥å¿—</li>
                    <li>åœ¨ç®¡ç†åå°ä¸­éªŒè¯åŒæ­¥æ•ˆæœ</li>
                </ol>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ“ æ“ä½œæ—¥å¿—</h2>
        <div id="logArea" class="log-area">
            <div class="info">ç­‰å¾…æ“ä½œ...</div>
        </div>
    </div>

    <script type="module">
        // æ¨¡æ‹Ÿè®¢å•æ•°æ®
        let orders = [
            {
                id: 1,
                userName: 'å¼ ä¸‰',
                userPhone: '13800138001',
                serviceName: 'åŸºç¡€æ´—è½¦',
                appointmentTime: '2024-10-25 10:00:00',
                price: 50,
                status: 'pending'
            },
            {
                id: 2,
                userName: 'æå››',
                userPhone: '13800138002',
                serviceName: 'ç²¾æ´—æœåŠ¡',
                appointmentTime: '2024-10-25 14:00:00',
                price: 100,
                status: 'confirmed'
            },
            {
                id: 3,
                userName: 'ç‹äº”',
                userPhone: '13800138003',
                serviceName: 'æ‰“èœ¡æœåŠ¡',
                appointmentTime: '2024-10-25 16:00:00',
                price: 150,
                status: 'processing'
            },
            {
                id: 4,
                userName: 'èµµå…­',
                userPhone: '13800138004',
                serviceName: 'å†…é¥°æ¸…æ´',
                appointmentTime: '2024-10-25 09:00:00',
                price: 80,
                status: 'completed'
            }
        ];

        // çŠ¶æ€æ˜ å°„
        const statusMap = {
            'pending': { text: 'å¾…ç¡®è®¤', class: 'status-pending' },
            'confirmed': { text: 'å·²ç¡®è®¤', class: 'status-confirmed' },
            'processing': { text: 'è¿›è¡Œä¸­', class: 'status-processing' },
            'completed': { text: 'å·²å®Œæˆ', class: 'status-completed' },
            'cancelled': { text: 'å·²å–æ¶ˆ', class: 'status-cancelled' }
        };

        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = type;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
        }

        // æ¨¡æ‹ŸAPIè°ƒç”¨
        async function mockApiCall(action, orderId, newStatus) {
            log(`ğŸ”„ ${action}ï¼Œè®¢å•ID: ${orderId}`, 'info');
            
            // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
            await new Promise(resolve => setTimeout(resolve, 300));
            
            // æ›´æ–°æœ¬åœ°æ•°æ®
            const order = orders.find(o => o.id === orderId);
            if (order) {
                const oldStatus = order.status;
                order.status = newStatus;
                log(`âœ… ${action}æˆåŠŸï¼ŒçŠ¶æ€æ›´æ–°: ${oldStatus} â†’ ${newStatus}`, 'success');
                renderTable();
                return true;
            } else {
                log(`âŒ ${action}å¤±è´¥ï¼Œè®¢å•ä¸å­˜åœ¨`, 'error');
                return false;
            }
        }

        // ç¡®è®¤é¢„çº¦
        async function confirmBooking(orderId) {
            await mockApiCall('ç¡®è®¤é¢„çº¦', orderId, 'confirmed');
        }

        // å¼€å§‹æœåŠ¡
        async function startService(orderId) {
            await mockApiCall('å¼€å§‹æœåŠ¡', orderId, 'processing');
        }

        // å®ŒæˆæœåŠ¡
        async function completeService(orderId) {
            await mockApiCall('å®ŒæˆæœåŠ¡', orderId, 'completed');
        }

        // å–æ¶ˆé¢„çº¦
        async function cancelBooking(orderId) {
            if (confirm('ç¡®å®šè¦å–æ¶ˆè¿™ä¸ªé¢„çº¦å—ï¼Ÿ')) {
                await mockApiCall('å–æ¶ˆé¢„çº¦', orderId, 'cancelled');
            }
        }

        // æ¸²æŸ“è¡¨æ ¼
        function renderTable() {
            const tbody = document.getElementById('orderTableBody');
            tbody.innerHTML = '';

            orders.forEach(order => {
                const row = document.createElement('tr');
                const statusInfo = statusMap[order.status];
                
                row.innerHTML = `
                    <td>${order.id}</td>
                    <td>${order.userName}</td>
                    <td>${order.userPhone}</td>
                    <td>${order.serviceName}</td>
                    <td>${order.appointmentTime}</td>
                    <td>Â¥${order.price}</td>
                    <td><span class="status-badge ${statusInfo.class}">${statusInfo.text}</span></td>
                    <td>
                        ${order.status === 'pending' ? 
                            `<button class="btn btn-primary" onclick="confirmBooking(${order.id})">ç¡®è®¤</button>` : ''}
                        ${order.status === 'confirmed' ? 
                            `<button class="btn btn-success" onclick="startService(${order.id})">å¼€å§‹æœåŠ¡</button>` : ''}
                        ${order.status === 'processing' ? 
                            `<button class="btn btn-warning" onclick="completeService(${order.id})">å®ŒæˆæœåŠ¡</button>` : ''}
                        ${['pending', 'confirmed'].includes(order.status) ? 
                            `<button class="btn btn-danger" onclick="cancelBooking(${order.id})">å–æ¶ˆ</button>` : ''}
                        <button class="btn btn-info" onclick="viewDetail(${order.id})">è¯¦æƒ…</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // æŸ¥çœ‹è¯¦æƒ…
        function viewDetail(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                log(`ğŸ‘ï¸ æŸ¥çœ‹è®¢å•è¯¦æƒ…: ${JSON.stringify(order)}`, 'info');
                alert(`è®¢å•è¯¦æƒ…:\\n${JSON.stringify(order, null, 2)}`);
            }
        }

        // é‡ç½®æµ‹è¯•æ•°æ®
        function resetTestData() {
            orders = [
                {
                    id: 1,
                    userName: 'å¼ ä¸‰',
                    userPhone: '13800138001',
                    serviceName: 'åŸºç¡€æ´—è½¦',
                    appointmentTime: '2024-10-25 10:00:00',
                    price: 50,
                    status: 'pending'
                },
                {
                    id: 2,
                    userName: 'æå››',
                    userPhone: '13800138002',
                    serviceName: 'ç²¾æ´—æœåŠ¡',
                    appointmentTime: '2024-10-25 14:00:00',
                    price: 100,
                    status: 'confirmed'
                },
                {
                    id: 3,
                    userName: 'ç‹äº”',
                    userPhone: '13800138003',
                    serviceName: 'æ‰“èœ¡æœåŠ¡',
                    appointmentTime: '2024-10-25 16:00:00',
                    price: 150,
                    status: 'processing'
                },
                {
                    id: 4,
                    userName: 'èµµå…­',
                    userPhone: '13800138004',
                    serviceName: 'å†…é¥°æ¸…æ´',
                    appointmentTime: '2024-10-25 09:00:00',
                    price: 80,
                    status: 'completed'
                }
            ];
            renderTable();
            log('ğŸ”„ æµ‹è¯•æ•°æ®å·²é‡ç½®', 'info');
        }

        // æ¸…ç©ºæ—¥å¿—
        function clearLog() {
            document.getElementById('logArea').innerHTML = '<div class="info">æ—¥å¿—å·²æ¸…ç©º...</div>';
        }

        // å°†å‡½æ•°æš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸ
        window.confirmBooking = confirmBooking;
        window.startService = startService;
        window.completeService = completeService;
        window.cancelBooking = cancelBooking;
        window.viewDetail = viewDetail;
        window.resetTestData = resetTestData;
        window.clearLog = clearLog;

        // åˆå§‹åŒ–
        renderTable();
        log('ğŸš€ æµ‹è¯•é¡µé¢å·²åŠ è½½ï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•çŠ¶æ€æ›´æ–°åŠŸèƒ½', 'success');
    </script>
</body>
</html>