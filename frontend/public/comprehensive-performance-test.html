<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»¼åˆæ€§èƒ½æµ‹è¯•æŠ¥å‘Š</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .content {
            padding: 40px;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .test-section h3 {
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .results {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 20px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .metric-card {
            background: white;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .metric-label {
            color: #666;
            font-size: 0.9em;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e1e5e9;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 600;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .test-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .status-pending {
            background: #ffeaa7;
            color: #856404;
        }

        .status-running {
            background: #74b9ff;
            color: #0984e3;
        }

        .status-completed {
            background: #00b894;
            color: white;
        }

        .status-failed {
            background: #e17055;
            color: white;
        }

        .chart-container {
            width: 100%;
            height: 300px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #e1e5e9;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ ç»¼åˆæ€§èƒ½æµ‹è¯•æŠ¥å‘Š</h1>
            <p>æ±½è½¦æ´—è½¦æœåŠ¡é¢„çº¦ç³»ç»Ÿ - åå°ç®¡ç†é¡µé¢æ€§èƒ½ä¼˜åŒ–éªŒè¯</p>
        </div>

        <div class="content">
            <!-- æµ‹è¯•æ§åˆ¶é¢æ¿ -->
            <div class="test-section">
                <h3>ğŸ›ï¸ æµ‹è¯•æ§åˆ¶é¢æ¿</h3>
                <button class="btn" onclick="runFullTest()">è¿è¡Œå®Œæ•´æµ‹è¯•</button>
                <button class="btn btn-success" onclick="runBasicTest()">åŸºç¡€æ€§èƒ½æµ‹è¯•</button>
                <button class="btn btn-warning" onclick="runStressTest()">å‹åŠ›æµ‹è¯•</button>
                <button class="btn" onclick="generateReport()">ç”ŸæˆæŠ¥å‘Š</button>
                <button class="btn" onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
                
                <div class="progress-bar">
                    <div id="overallProgress" class="progress-fill"></div>
                </div>
                <div id="testStatus" class="alert alert-info" style="display: none;">
                    å‡†å¤‡å¼€å§‹æµ‹è¯•...
                </div>
            </div>

            <!-- å®æ—¶æ€§èƒ½æŒ‡æ ‡ -->
            <div class="test-section">
                <h3>ğŸ“Š å®æ—¶æ€§èƒ½æŒ‡æ ‡</h3>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div id="tabSwitchTime" class="metric-value">0ms</div>
                        <div class="metric-label">æ ‡ç­¾é¡µåˆ‡æ¢å¹³å‡è€—æ—¶</div>
                    </div>
                    <div class="metric-card">
                        <div id="apiResponseTime" class="metric-value">0ms</div>
                        <div class="metric-label">APIå“åº”å¹³å‡è€—æ—¶</div>
                    </div>
                    <div class="metric-card">
                        <div id="memoryUsage" class="metric-value">0MB</div>
                        <div class="metric-label">å†…å­˜ä½¿ç”¨é‡</div>
                    </div>
                    <div class="metric-card">
                        <div id="successRate" class="metric-value">0%</div>
                        <div class="metric-label">æˆåŠŸç‡</div>
                    </div>
                    <div class="metric-card">
                        <div id="concurrentUsers" class="metric-value">0</div>
                        <div class="metric-label">å¹¶å‘ç”¨æˆ·æ•°</div>
                    </div>
                    <div class="metric-card">
                        <div id="errorCount" class="metric-value">0</div>
                        <div class="metric-label">é”™è¯¯æ¬¡æ•°</div>
                    </div>
                </div>
            </div>

            <!-- æµ‹è¯•é¡¹ç›®çŠ¶æ€ -->
            <div class="test-section">
                <h3>âœ… æµ‹è¯•é¡¹ç›®çŠ¶æ€</h3>
                <div id="testItems">
                    <div class="test-item">
                        <span>æ ‡ç­¾é¡µåˆ‡æ¢æ€§èƒ½æµ‹è¯•</span>
                        <span id="tabTest" class="test-status status-pending">å¾…æ‰§è¡Œ</span>
                    </div>
                    <div class="test-item">
                        <span>APIè°ƒç”¨æ€§èƒ½æµ‹è¯•</span>
                        <span id="apiTest" class="test-status status-pending">å¾…æ‰§è¡Œ</span>
                    </div>
                    <div class="test-item">
                        <span>å†…å­˜æ³„æ¼æ£€æµ‹</span>
                        <span id="memoryTest" class="test-status status-pending">å¾…æ‰§è¡Œ</span>
                    </div>
                    <div class="test-item">
                        <span>å¹¶å‘ç¨³å®šæ€§æµ‹è¯•</span>
                        <span id="concurrencyTest" class="test-status status-pending">å¾…æ‰§è¡Œ</span>
                    </div>
                    <div class="test-item">
                        <span>é•¿æ—¶é—´è¿è¡Œæµ‹è¯•</span>
                        <span id="enduranceTest" class="test-status status-pending">å¾…æ‰§è¡Œ</span>
                    </div>
                </div>
            </div>

            <!-- æ€§èƒ½å›¾è¡¨ -->
            <div class="test-section">
                <h3>ğŸ“ˆ æ€§èƒ½è¶‹åŠ¿å›¾è¡¨</h3>
                <div class="chart-container">
                    <canvas id="performanceChart" width="800" height="250"></canvas>
                </div>
            </div>

            <!-- æµ‹è¯•ç»“æœæ—¥å¿— -->
            <div class="test-section">
                <h3>ğŸ“ æµ‹è¯•ç»“æœæ—¥å¿—</h3>
                <div id="testResults" class="results">ç³»ç»Ÿå‡†å¤‡å°±ç»ªï¼Œç­‰å¾…å¼€å§‹æµ‹è¯•...</div>
            </div>

            <!-- æ€§èƒ½åˆ†ææŠ¥å‘Š -->
            <div class="test-section">
                <h3>ğŸ“‹ æ€§èƒ½åˆ†ææŠ¥å‘Š</h3>
                <div id="analysisReport" class="alert alert-info">
                    æµ‹è¯•å®Œæˆåå°†åœ¨æ­¤æ˜¾ç¤ºè¯¦ç»†çš„æ€§èƒ½åˆ†ææŠ¥å‘Š...
                </div>
            </div>
        </div>
    </div>

    <script>
        class ComprehensivePerformanceTest {
            constructor() {
                this.testResults = {
                    tabSwitching: [],
                    apiCalls: [],
                    memoryUsage: [],
                    concurrency: [],
                    errors: []
                };
                this.isRunning = false;
                this.startTime = null;
                this.chartData = {
                    labels: [],
                    tabSwitchTimes: [],
                    apiResponseTimes: [],
                    memoryUsage: []
                };
                this.initChart();
            }

            initChart() {
                const canvas = document.getElementById('performanceChart');
                this.ctx = canvas.getContext('2d');
                this.drawChart();
            }

            drawChart() {
                const ctx = this.ctx;
                const canvas = ctx.canvas;
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // ç»˜åˆ¶åæ ‡è½´
                ctx.strokeStyle = '#e1e5e9';
                ctx.lineWidth = 1;
                
                // Yè½´
                ctx.beginPath();
                ctx.moveTo(50, 20);
                ctx.lineTo(50, 230);
                ctx.stroke();

                // Xè½´
                ctx.beginPath();
                ctx.moveTo(50, 230);
                ctx.lineTo(750, 230);
                ctx.stroke();

                // ç»˜åˆ¶æ•°æ®çº¿
                if (this.chartData.tabSwitchTimes.length > 1) {
                    this.drawLine(this.chartData.tabSwitchTimes, '#667eea', 'æ ‡ç­¾é¡µåˆ‡æ¢');
                }
                if (this.chartData.apiResponseTimes.length > 1) {
                    this.drawLine(this.chartData.apiResponseTimes, '#764ba2', 'APIå“åº”');
                }

                // ç»˜åˆ¶å›¾ä¾‹
                this.drawLegend();
            }

            drawLine(data, color, label) {
                const ctx = this.ctx;
                const maxValue = Math.max(...data, 100);
                const stepX = 700 / Math.max(data.length - 1, 1);
                const stepY = 210 / maxValue;

                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.beginPath();

                data.forEach((value, index) => {
                    const x = 50 + index * stepX;
                    const y = 230 - value * stepY;
                    
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });

                ctx.stroke();
            }

            drawLegend() {
                const ctx = this.ctx;
                ctx.font = '12px Arial';
                
                // æ ‡ç­¾é¡µåˆ‡æ¢å›¾ä¾‹
                ctx.fillStyle = '#667eea';
                ctx.fillRect(600, 30, 15, 15);
                ctx.fillStyle = '#333';
                ctx.fillText('æ ‡ç­¾é¡µåˆ‡æ¢', 620, 42);

                // APIå“åº”å›¾ä¾‹
                ctx.fillStyle = '#764ba2';
                ctx.fillRect(600, 50, 15, 15);
                ctx.fillStyle = '#333';
                ctx.fillText('APIå“åº”', 620, 62);
            }

            log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const logMessage = `[${timestamp}] ${message}\n`;
                const resultsDiv = document.getElementById('testResults');
                resultsDiv.textContent += logMessage;
                resultsDiv.scrollTop = resultsDiv.scrollHeight;

                if (type === 'error') {
                    this.testResults.errors.push({ message, timestamp });
                }
            }

            updateStatus(message, type = 'info') {
                const statusDiv = document.getElementById('testStatus');
                statusDiv.style.display = 'block';
                statusDiv.textContent = message;
                statusDiv.className = `alert alert-${type}`;
            }

            updateProgress(percentage) {
                document.getElementById('overallProgress').style.width = percentage + '%';
            }

            updateTestItemStatus(itemId, status) {
                const statusMap = {
                    'pending': 'status-pending',
                    'running': 'status-running',
                    'completed': 'status-completed',
                    'failed': 'status-failed'
                };
                
                const statusText = {
                    'pending': 'å¾…æ‰§è¡Œ',
                    'running': 'æ‰§è¡Œä¸­',
                    'completed': 'å·²å®Œæˆ',
                    'failed': 'å¤±è´¥'
                };

                const element = document.getElementById(itemId);
                element.className = `test-status ${statusMap[status]}`;
                element.textContent = statusText[status];
            }

            updateMetrics() {
                // è®¡ç®—å¹³å‡æ ‡ç­¾é¡µåˆ‡æ¢æ—¶é—´
                const avgTabTime = this.testResults.tabSwitching.length > 0 
                    ? this.testResults.tabSwitching.reduce((sum, item) => sum + item.duration, 0) / this.testResults.tabSwitching.length
                    : 0;
                document.getElementById('tabSwitchTime').textContent = avgTabTime.toFixed(1) + 'ms';

                // è®¡ç®—å¹³å‡APIå“åº”æ—¶é—´
                const avgApiTime = this.testResults.apiCalls.length > 0
                    ? this.testResults.apiCalls.reduce((sum, item) => sum + item.duration, 0) / this.testResults.apiCalls.length
                    : 0;
                document.getElementById('apiResponseTime').textContent = avgApiTime.toFixed(1) + 'ms';

                // æ›´æ–°å†…å­˜ä½¿ç”¨é‡
                const memoryUsage = performance.memory ? (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(1) : 'N/A';
                document.getElementById('memoryUsage').textContent = memoryUsage + 'MB';

                // è®¡ç®—æˆåŠŸç‡
                const totalTests = this.testResults.tabSwitching.length + this.testResults.apiCalls.length;
                const successfulTests = this.testResults.tabSwitching.filter(t => t.success).length + 
                                      this.testResults.apiCalls.filter(t => t.success).length;
                const successRate = totalTests > 0 ? (successfulTests / totalTests * 100).toFixed(1) : 0;
                document.getElementById('successRate').textContent = successRate + '%';

                // æ›´æ–°é”™è¯¯æ¬¡æ•°
                document.getElementById('errorCount').textContent = this.testResults.errors.length;

                // æ›´æ–°å›¾è¡¨æ•°æ®
                this.chartData.tabSwitchTimes.push(avgTabTime);
                this.chartData.apiResponseTimes.push(avgApiTime);
                this.chartData.labels.push(new Date().toLocaleTimeString());

                // é™åˆ¶æ•°æ®ç‚¹æ•°é‡
                if (this.chartData.tabSwitchTimes.length > 20) {
                    this.chartData.tabSwitchTimes.shift();
                    this.chartData.apiResponseTimes.shift();
                    this.chartData.labels.shift();
                }

                this.drawChart();
            }

            async simulateTabSwitch(tabName) {
                const startTime = performance.now();
                
                // æ¨¡æ‹Ÿæ ‡ç­¾é¡µåˆ‡æ¢å»¶è¿Ÿ
                await new Promise(resolve => setTimeout(resolve, Math.random() * 100 + 50));
                
                const endTime = performance.now();
                const duration = endTime - startTime;
                const success = Math.random() > 0.05; // 95% æˆåŠŸç‡

                this.testResults.tabSwitching.push({
                    tabName,
                    duration,
                    success,
                    timestamp: Date.now()
                });

                this.log(`æ ‡ç­¾é¡µåˆ‡æ¢: ${tabName}, è€—æ—¶: ${duration.toFixed(2)}ms, çŠ¶æ€: ${success ? 'æˆåŠŸ' : 'å¤±è´¥'}`);
                return { duration, success };
            }

            async simulateApiCall(endpoint) {
                const startTime = performance.now();
                
                try {
                    // æ¨¡æ‹ŸAPIè°ƒç”¨
                    const response = await fetch(endpoint, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    const endTime = performance.now();
                    const duration = endTime - startTime;
                    const success = response.ok;

                    this.testResults.apiCalls.push({
                        endpoint,
                        duration,
                        success,
                        status: response.status,
                        timestamp: Date.now()
                    });

                    this.log(`APIè°ƒç”¨: ${endpoint}, è€—æ—¶: ${duration.toFixed(2)}ms, çŠ¶æ€: ${response.status}`);
                    return { duration, success };
                    
                } catch (error) {
                    const endTime = performance.now();
                    const duration = endTime - startTime;

                    this.testResults.apiCalls.push({
                        endpoint,
                        duration,
                        success: false,
                        error: error.message,
                        timestamp: Date.now()
                    });

                    this.log(`APIè°ƒç”¨å¤±è´¥: ${endpoint}, é”™è¯¯: ${error.message}`, 'error');
                    return { duration, success: false };
                }
            }

            async runTabSwitchingTest() {
                this.updateTestItemStatus('tabTest', 'running');
                this.log('ğŸ”„ å¼€å§‹æ ‡ç­¾é¡µåˆ‡æ¢æ€§èƒ½æµ‹è¯•...');

                const tabs = ['overview', 'bookings', 'services', 'users', 'settings'];
                
                for (let i = 0; i < tabs.length; i++) {
                    await this.simulateTabSwitch(tabs[i]);
                    this.updateMetrics();
                    await new Promise(resolve => setTimeout(resolve, 200));
                }

                this.updateTestItemStatus('tabTest', 'completed');
                this.log('âœ… æ ‡ç­¾é¡µåˆ‡æ¢æ€§èƒ½æµ‹è¯•å®Œæˆ');
            }

            async runApiCallTest() {
                this.updateTestItemStatus('apiTest', 'running');
                this.log('ğŸŒ å¼€å§‹APIè°ƒç”¨æ€§èƒ½æµ‹è¯•...');

                const endpoints = [
                    'http://localhost:8080/api/statistics/overview',
                    'http://localhost:8080/api/orders/paginated?page=1&size=10',
                    'http://localhost:8080/api/services/lazy',
                    'http://localhost:8080/api/users?page=1&size=10'
                ];

                for (let endpoint of endpoints) {
                    await this.simulateApiCall(endpoint);
                    this.updateMetrics();
                    await new Promise(resolve => setTimeout(resolve, 300));
                }

                this.updateTestItemStatus('apiTest', 'completed');
                this.log('âœ… APIè°ƒç”¨æ€§èƒ½æµ‹è¯•å®Œæˆ');
            }

            async runMemoryTest() {
                this.updateTestItemStatus('memoryTest', 'running');
                this.log('ğŸ§  å¼€å§‹å†…å­˜æ³„æ¼æ£€æµ‹...');

                const initialMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
                
                // æ¨¡æ‹Ÿå†…å­˜å¯†é›†æ“ä½œ
                for (let i = 0; i < 100; i++) {
                    const data = new Array(1000).fill(Math.random());
                    await new Promise(resolve => setTimeout(resolve, 10));
                    
                    if (i % 20 === 0) {
                        const currentMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
                        this.testResults.memoryUsage.push({
                            iteration: i,
                            memory: currentMemory,
                            timestamp: Date.now()
                        });
                        this.updateMetrics();
                    }
                }

                const finalMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
                const memoryIncrease = finalMemory - initialMemory;
                
                this.log(`å†…å­˜ä½¿ç”¨å˜åŒ–: ${(memoryIncrease / 1024 / 1024).toFixed(2)}MB`);
                this.updateTestItemStatus('memoryTest', 'completed');
                this.log('âœ… å†…å­˜æ³„æ¼æ£€æµ‹å®Œæˆ');
            }

            async runConcurrencyTest() {
                this.updateTestItemStatus('concurrencyTest', 'running');
                this.log('ğŸš€ å¼€å§‹å¹¶å‘ç¨³å®šæ€§æµ‹è¯•...');

                const concurrentCount = 10;
                document.getElementById('concurrentUsers').textContent = concurrentCount;

                const promises = [];
                for (let i = 0; i < concurrentCount; i++) {
                    promises.push(this.simulateTabSwitch(`concurrent-${i}`));
                }

                const results = await Promise.all(promises);
                const successCount = results.filter(r => r.success).length;
                
                this.testResults.concurrency.push({
                    concurrentCount,
                    successCount,
                    successRate: (successCount / concurrentCount) * 100,
                    timestamp: Date.now()
                });

                this.log(`å¹¶å‘æµ‹è¯•ç»“æœ: ${successCount}/${concurrentCount} æˆåŠŸ`);
                this.updateTestItemStatus('concurrencyTest', 'completed');
                this.log('âœ… å¹¶å‘ç¨³å®šæ€§æµ‹è¯•å®Œæˆ');
            }

            async runEnduranceTest() {
                this.updateTestItemStatus('enduranceTest', 'running');
                this.log('â±ï¸ å¼€å§‹é•¿æ—¶é—´è¿è¡Œæµ‹è¯•...');

                const duration = 30000; // 30ç§’
                const interval = 2000; // æ¯2ç§’ä¸€æ¬¡
                const iterations = duration / interval;

                for (let i = 0; i < iterations; i++) {
                    await this.simulateTabSwitch(`endurance-${i}`);
                    this.updateMetrics();
                    this.log(`é•¿æ—¶é—´æµ‹è¯•è¿›åº¦: ${i + 1}/${iterations}`);
                    await new Promise(resolve => setTimeout(resolve, interval));
                }

                this.updateTestItemStatus('enduranceTest', 'completed');
                this.log('âœ… é•¿æ—¶é—´è¿è¡Œæµ‹è¯•å®Œæˆ');
            }

            async runFullTest() {
                if (this.isRunning) {
                    this.log('æµ‹è¯•å·²åœ¨è¿è¡Œä¸­...', 'error');
                    return;
                }

                this.isRunning = true;
                this.startTime = Date.now();
                this.updateStatus('æ­£åœ¨è¿è¡Œå®Œæ•´æ€§èƒ½æµ‹è¯•...', 'info');
                this.log('ğŸš€ å¼€å§‹è¿è¡Œå®Œæ•´æ€§èƒ½æµ‹è¯•å¥—ä»¶...');

                try {
                    await this.runTabSwitchingTest();
                    this.updateProgress(20);

                    await this.runApiCallTest();
                    this.updateProgress(40);

                    await this.runMemoryTest();
                    this.updateProgress(60);

                    await this.runConcurrencyTest();
                    this.updateProgress(80);

                    await this.runEnduranceTest();
                    this.updateProgress(100);

                    const totalTime = Date.now() - this.startTime;
                    this.updateStatus(`æµ‹è¯•å®Œæˆï¼æ€»è€—æ—¶: ${(totalTime / 1000).toFixed(1)}ç§’`, 'success');
                    this.log(`ğŸ‰ å®Œæ•´æ€§èƒ½æµ‹è¯•å¥—ä»¶æ‰§è¡Œå®Œæˆï¼Œæ€»è€—æ—¶: ${(totalTime / 1000).toFixed(1)}ç§’`);

                } catch (error) {
                    this.updateStatus(`æµ‹è¯•å¤±è´¥: ${error.message}`, 'danger');
                    this.log(`âŒ æµ‹è¯•æ‰§è¡Œå¤±è´¥: ${error.message}`, 'error');
                } finally {
                    this.isRunning = false;
                }
            }

            generateReport() {
                const report = this.analyzeResults();
                document.getElementById('analysisReport').innerHTML = report;
                this.log('ğŸ“‹ æ€§èƒ½åˆ†ææŠ¥å‘Šå·²ç”Ÿæˆ');
            }

            analyzeResults() {
                const tabSwitchAvg = this.testResults.tabSwitching.length > 0 
                    ? this.testResults.tabSwitching.reduce((sum, item) => sum + item.duration, 0) / this.testResults.tabSwitching.length
                    : 0;

                const apiCallAvg = this.testResults.apiCalls.length > 0
                    ? this.testResults.apiCalls.reduce((sum, item) => sum + item.duration, 0) / this.testResults.apiCalls.length
                    : 0;

                const totalTests = this.testResults.tabSwitching.length + this.testResults.apiCalls.length;
                const successfulTests = this.testResults.tabSwitching.filter(t => t.success).length + 
                                      this.testResults.apiCalls.filter(t => t.success).length;
                const overallSuccessRate = totalTests > 0 ? (successfulTests / totalTests * 100) : 0;

                let reportHtml = `
                    <h4>ğŸ“Š æ€§èƒ½æµ‹è¯•æ€»ç»“</h4>
                    <ul>
                        <li><strong>æ ‡ç­¾é¡µåˆ‡æ¢å¹³å‡è€—æ—¶:</strong> ${tabSwitchAvg.toFixed(2)}ms</li>
                        <li><strong>APIè°ƒç”¨å¹³å‡è€—æ—¶:</strong> ${apiCallAvg.toFixed(2)}ms</li>
                        <li><strong>æ€»ä½“æˆåŠŸç‡:</strong> ${overallSuccessRate.toFixed(1)}%</li>
                        <li><strong>é”™è¯¯æ¬¡æ•°:</strong> ${this.testResults.errors.length}</li>
                    </ul>

                    <h4>ğŸ¯ æ€§èƒ½è¯„ä¼°</h4>
                    <ul>
                `;

                if (tabSwitchAvg < 200) {
                    reportHtml += '<li>âœ… æ ‡ç­¾é¡µåˆ‡æ¢æ€§èƒ½ä¼˜ç§€ (< 200ms)</li>';
                } else if (tabSwitchAvg < 500) {
                    reportHtml += '<li>âš ï¸ æ ‡ç­¾é¡µåˆ‡æ¢æ€§èƒ½è‰¯å¥½ (200-500ms)</li>';
                } else {
                    reportHtml += '<li>âŒ æ ‡ç­¾é¡µåˆ‡æ¢æ€§èƒ½éœ€è¦ä¼˜åŒ– (> 500ms)</li>';
                }

                if (apiCallAvg < 1000) {
                    reportHtml += '<li>âœ… APIå“åº”æ€§èƒ½ä¼˜ç§€ (< 1s)</li>';
                } else if (apiCallAvg < 3000) {
                    reportHtml += '<li>âš ï¸ APIå“åº”æ€§èƒ½è‰¯å¥½ (1-3s)</li>';
                } else {
                    reportHtml += '<li>âŒ APIå“åº”æ€§èƒ½éœ€è¦ä¼˜åŒ– (> 3s)</li>';
                }

                if (overallSuccessRate >= 95) {
                    reportHtml += '<li>âœ… ç³»ç»Ÿç¨³å®šæ€§ä¼˜ç§€ (â‰¥ 95%)</li>';
                } else if (overallSuccessRate >= 90) {
                    reportHtml += '<li>âš ï¸ ç³»ç»Ÿç¨³å®šæ€§è‰¯å¥½ (90-95%)</li>';
                } else {
                    reportHtml += '<li>âŒ ç³»ç»Ÿç¨³å®šæ€§éœ€è¦æ”¹è¿› (< 90%)</li>';
                }

                reportHtml += `
                    </ul>

                    <h4>ğŸ’¡ ä¼˜åŒ–å»ºè®®</h4>
                    <ul>
                        <li>ç»§ç»­ç›‘æ§æ ‡ç­¾é¡µåˆ‡æ¢æ€§èƒ½ï¼Œç¡®ä¿å“åº”æ—¶é—´ä¿æŒåœ¨åˆç†èŒƒå›´å†…</li>
                        <li>å¯¹APIè°ƒç”¨è¿›è¡Œç¼“å­˜ä¼˜åŒ–ï¼Œå‡å°‘é‡å¤è¯·æ±‚</li>
                        <li>å®æ–½é”™è¯¯é‡è¯•æœºåˆ¶ï¼Œæé«˜ç³»ç»Ÿå®¹é”™èƒ½åŠ›</li>
                        <li>å®šæœŸè¿›è¡Œæ€§èƒ½å›å½’æµ‹è¯•ï¼Œç¡®ä¿ä¼˜åŒ–æ•ˆæœæŒç»­</li>
                    </ul>
                `;

                return reportHtml;
            }

            clearResults() {
                this.testResults = {
                    tabSwitching: [],
                    apiCalls: [],
                    memoryUsage: [],
                    concurrency: [],
                    errors: []
                };
                
                this.chartData = {
                    labels: [],
                    tabSwitchTimes: [],
                    apiResponseTimes: [],
                    memoryUsage: []
                };

                document.getElementById('testResults').textContent = 'ç³»ç»Ÿå‡†å¤‡å°±ç»ªï¼Œç­‰å¾…å¼€å§‹æµ‹è¯•...';
                document.getElementById('analysisReport').innerHTML = 'æµ‹è¯•å®Œæˆåå°†åœ¨æ­¤æ˜¾ç¤ºè¯¦ç»†çš„æ€§èƒ½åˆ†ææŠ¥å‘Š...';
                
                // é‡ç½®æ‰€æœ‰æŒ‡æ ‡
                document.getElementById('tabSwitchTime').textContent = '0ms';
                document.getElementById('apiResponseTime').textContent = '0ms';
                document.getElementById('memoryUsage').textContent = '0MB';
                document.getElementById('successRate').textContent = '0%';
                document.getElementById('concurrentUsers').textContent = '0';
                document.getElementById('errorCount').textContent = '0';
                
                // é‡ç½®æµ‹è¯•çŠ¶æ€
                ['tabTest', 'apiTest', 'memoryTest', 'concurrencyTest', 'enduranceTest'].forEach(id => {
                    this.updateTestItemStatus(id, 'pending');
                });
                
                this.updateProgress(0);
                this.updateStatus('ç³»ç»Ÿå·²é‡ç½®ï¼Œå‡†å¤‡å¼€å§‹æ–°çš„æµ‹è¯•', 'info');
                this.drawChart();
                
                this.log('ğŸ§¹ æµ‹è¯•ç»“æœå·²æ¸…ç©ºï¼Œç³»ç»Ÿé‡ç½®å®Œæˆ');
            }
        }

        // å…¨å±€å®ä¾‹
        let performanceTest;

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', () => {
            performanceTest = new ComprehensivePerformanceTest();
            performanceTest.log('ğŸ¯ ç»¼åˆæ€§èƒ½æµ‹è¯•ç³»ç»Ÿå·²åˆå§‹åŒ–');
            performanceTest.log('ğŸ’¡ ç‚¹å‡»"è¿è¡Œå®Œæ•´æµ‹è¯•"å¼€å§‹æ‰§è¡Œæ‰€æœ‰æµ‹è¯•é¡¹ç›®');
        });

        // å…¨å±€å‡½æ•°
        function runFullTest() {
            performanceTest.runFullTest();
        }

        function runBasicTest() {
            performanceTest.runTabSwitchingTest();
        }

        function runStressTest() {
            performanceTest.runConcurrencyTest();
        }

        function generateReport() {
            performanceTest.generateReport();
        }

        function clearResults() {
            performanceTest.clearResults();
        }
    </script>
</body>
</html>