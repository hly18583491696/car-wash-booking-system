<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•é€šçŸ¥é…ç½®å¼€å…³</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .config-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .config-section h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .config-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        .config-item:last-child {
            border-bottom: none;
        }
        .config-label {
            font-weight: bold;
            color: #555;
        }
        .config-value {
            padding: 5px 10px;
            border-radius: 4px;
            font-family: monospace;
        }
        .enabled {
            background-color: #d4edda;
            color: #155724;
        }
        .disabled {
            background-color: #f8d7da;
            color: #721c24;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .test-button {
            background-color: #28a745;
        }
        .test-button:hover {
            background-color: #1e7e34;
        }
        .danger-button {
            background-color: #dc3545;
        }
        .danger-button:hover {
            background-color: #c82333;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .log-viewer {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš™ï¸ é€šçŸ¥é…ç½®å¼€å…³æµ‹è¯•</h1>
        
        <!-- å½“å‰é…ç½®æ˜¾ç¤º -->
        <div class="config-section">
            <h3>ğŸ“‹ å½“å‰é…ç½®çŠ¶æ€</h3>
            <div id="currentConfig">
                <div class="config-item">
                    <span class="config-label">SMS é€šçŸ¥:</span>
                    <span class="config-value enabled" id="smsEnabled">å¯ç”¨</span>
                </div>
                <div class="config-item">
                    <span class="config-label">SMS è®¢å•çŠ¶æ€é€šçŸ¥:</span>
                    <span class="config-value enabled" id="smsOrderEnabled">å¯ç”¨</span>
                </div>
                <div class="config-item">
                    <span class="config-label">SMS éªŒè¯ç :</span>
                    <span class="config-value enabled" id="smsVerificationEnabled">å¯ç”¨</span>
                </div>
                <div class="config-item">
                    <span class="config-label">é‚®ä»¶é€šçŸ¥:</span>
                    <span class="config-value disabled" id="emailEnabled">ç¦ç”¨</span>
                </div>
                <div class="config-item">
                    <span class="config-label">é‚®ä»¶è®¢å•çŠ¶æ€é€šçŸ¥:</span>
                    <span class="config-value disabled" id="emailOrderEnabled">ç¦ç”¨</span>
                </div>
                <div class="config-item">
                    <span class="config-label">å¾®ä¿¡é€šçŸ¥:</span>
                    <span class="config-value disabled" id="wechatEnabled">ç¦ç”¨</span>
                </div>
                <div class="config-item">
                    <span class="config-label">å¾®ä¿¡è®¢å•çŠ¶æ€é€šçŸ¥:</span>
                    <span class="config-value disabled" id="wechatOrderEnabled">ç¦ç”¨</span>
                </div>
                <div class="config-item">
                    <span class="config-label">ç«™å†…æ¶ˆæ¯:</span>
                    <span class="config-value enabled" id="inAppEnabled">å¯ç”¨</span>
                </div>
                <div class="config-item">
                    <span class="config-label">ç«™å†…è®¢å•çŠ¶æ€é€šçŸ¥:</span>
                    <span class="config-value enabled" id="inAppOrderEnabled">å¯ç”¨</span>
                </div>
            </div>
            <button onclick="refreshConfig()">ğŸ”„ åˆ·æ–°é…ç½®</button>
        </div>

        <!-- é…ç½®ä¿®æ”¹æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ”§ é…ç½®ä¿®æ”¹æµ‹è¯•</h3>
            <div class="warning result">
                <strong>æ³¨æ„ï¼š</strong>å½“å‰é…ç½®æ¥è‡ª application.yml æ–‡ä»¶ï¼Œéœ€è¦é‡å¯æœåŠ¡æ‰èƒ½ç”Ÿæ•ˆã€‚
                è¿™é‡Œæ¼”ç¤ºå¦‚ä½•é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥æµ‹è¯•ä¸åŒçš„é€šçŸ¥å¼€å…³çŠ¶æ€ã€‚
            </div>
            
            <div class="form-group">
                <label>é€‰æ‹©è¦æµ‹è¯•çš„é…ç½®åœºæ™¯:</label>
                <select id="configScenario">
                    <option value="all-enabled">å…¨éƒ¨å¯ç”¨</option>
                    <option value="sms-only">ä»…SMSå¯ç”¨</option>
                    <option value="sms-disabled">SMSç¦ç”¨</option>
                    <option value="order-disabled">è®¢å•é€šçŸ¥ç¦ç”¨</option>
                    <option value="all-disabled">å…¨éƒ¨ç¦ç”¨</option>
                </select>
            </div>
            
            <button onclick="generateConfigYaml()" class="test-button">ç”Ÿæˆé…ç½®æ–‡ä»¶</button>
            <button onclick="showCurrentYaml()">æŸ¥çœ‹å½“å‰é…ç½®</button>
            
            <div id="configResult" class="result" style="display: none;"></div>
        </div>

        <!-- é€šçŸ¥åŠŸèƒ½æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ“± é€šçŸ¥åŠŸèƒ½æµ‹è¯•</h3>
            <div class="form-group">
                <label for="testPhone">æµ‹è¯•æ‰‹æœºå·:</label>
                <input type="text" id="testPhone" value="13800138000" placeholder="è¯·è¾“å…¥æ‰‹æœºå·">
            </div>
            <div class="form-group">
                <label for="testMessage">æµ‹è¯•æ¶ˆæ¯:</label>
                <textarea id="testMessage" rows="3" placeholder="è¯·è¾“å…¥æµ‹è¯•æ¶ˆæ¯å†…å®¹">æ‚¨çš„è®¢å•çŠ¶æ€å·²æ›´æ–°ä¸ºï¼šå·²ç¡®è®¤ã€‚æ„Ÿè°¢æ‚¨çš„ä½¿ç”¨ï¼</textarea>
            </div>
            
            <button onclick="testSmsNotification()" class="test-button">æµ‹è¯•SMSé€šçŸ¥</button>
            <button onclick="testEmailNotification()" class="test-button">æµ‹è¯•é‚®ä»¶é€šçŸ¥</button>
            <button onclick="testWechatNotification()" class="test-button">æµ‹è¯•å¾®ä¿¡é€šçŸ¥</button>
            <button onclick="testInAppNotification()" class="test-button">æµ‹è¯•ç«™å†…æ¶ˆæ¯</button>
            
            <div id="testResult" class="result" style="display: none;"></div>
        </div>

        <!-- æ—¥å¿—æŸ¥çœ‹å™¨ -->
        <div class="test-section">
            <h3>ğŸ“„ åç«¯æ—¥å¿—ç›‘æ§</h3>
            <p>ç›‘æ§åç«¯æ—¥å¿—ä»¥æŸ¥çœ‹é€šçŸ¥å‘é€æƒ…å†µå’Œé…ç½®å¼€å…³æ•ˆæœï¼š</p>
            <button onclick="startLogMonitoring()" class="test-button">å¼€å§‹ç›‘æ§æ—¥å¿—</button>
            <button onclick="stopLogMonitoring()" class="danger-button">åœæ­¢ç›‘æ§</button>
            <button onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
            
            <div id="logViewer" class="log-viewer" style="display: none;">
                <div id="logContent">ç­‰å¾…æ—¥å¿—æ•°æ®...</div>
            </div>
        </div>

        <!-- æµ‹è¯•è¯´æ˜ -->
        <div class="test-section">
            <h3>ğŸ“– æµ‹è¯•è¯´æ˜</h3>
            <div class="info result">
é…ç½®å¼€å…³æµ‹è¯•æµç¨‹ï¼š

1. æŸ¥çœ‹å½“å‰é…ç½®çŠ¶æ€
   - æ˜¾ç¤ºæ‰€æœ‰é€šçŸ¥ç±»å‹çš„å¯ç”¨/ç¦ç”¨çŠ¶æ€
   - é…ç½®æ¥æºäº application.yml æ–‡ä»¶

2. ç”Ÿæˆä¸åŒé…ç½®åœºæ™¯
   - å…¨éƒ¨å¯ç”¨ï¼šæ‰€æœ‰é€šçŸ¥ç±»å‹éƒ½å¯ç”¨
   - ä»…SMSå¯ç”¨ï¼šåªå¯ç”¨SMSé€šçŸ¥
   - SMSç¦ç”¨ï¼šç¦ç”¨æ‰€æœ‰SMSé€šçŸ¥
   - è®¢å•é€šçŸ¥ç¦ç”¨ï¼šç¦ç”¨æ‰€æœ‰è®¢å•çŠ¶æ€é€šçŸ¥
   - å…¨éƒ¨ç¦ç”¨ï¼šç¦ç”¨æ‰€æœ‰é€šçŸ¥

3. æµ‹è¯•é€šçŸ¥åŠŸèƒ½
   - å‘é€æµ‹è¯•é€šçŸ¥ï¼Œè§‚å¯Ÿé…ç½®å¼€å…³æ•ˆæœ
   - æŸ¥çœ‹åç«¯æ—¥å¿—ç¡®è®¤æ˜¯å¦æŒ‰é…ç½®æ‰§è¡Œ

4. éªŒè¯é…ç½®æ•ˆæœ
   - å¯ç”¨çš„é€šçŸ¥åº”è¯¥æ­£å¸¸å‘é€
   - ç¦ç”¨çš„é€šçŸ¥åº”è¯¥è·³è¿‡å‘é€
   - æ—¥å¿—ä¸­åº”è¯¥æ˜¾ç¤ºç›¸åº”çš„æç¤ºä¿¡æ¯

æ³¨æ„äº‹é¡¹ï¼š
- é…ç½®ä¿®æ”¹éœ€è¦é‡å¯æœåŠ¡æ‰èƒ½ç”Ÿæ•ˆ
- å½“å‰ä½¿ç”¨æ¨¡æ‹Ÿé€šçŸ¥å‘é€
- å¯ä»¥é€šè¿‡æ—¥å¿—æŸ¥çœ‹é…ç½®å¼€å…³çš„å®é™…æ•ˆæœ
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api';
        let logMonitorInterval = null;

        // è·å–JWT Token
        function getAuthToken() {
            return localStorage.getItem('token') || '';
        }

        // åˆ·æ–°é…ç½®æ˜¾ç¤º
        async function refreshConfig() {
            try {
                const response = await fetch(`${API_BASE}/notification-test/config`);
                const result = await response.json();
                
                if (result.code === 200) {
                    const config = result.data;
                    
                    // æ›´æ–°SMSé…ç½®æ˜¾ç¤º
                    updateConfigDisplay('smsEnabled', config.sms.enabled);
                    updateConfigDisplay('smsOrderEnabled', config.sms.orderStatusEnabled);
                    updateConfigDisplay('smsVerificationEnabled', config.sms.verificationEnabled);
                    
                    // æ›´æ–°é‚®ä»¶é…ç½®æ˜¾ç¤º
                    updateConfigDisplay('emailEnabled', config.email.enabled);
                    updateConfigDisplay('emailOrderEnabled', config.email.orderStatusEnabled);
                    
                    // æ›´æ–°å¾®ä¿¡é…ç½®æ˜¾ç¤º
                    updateConfigDisplay('wechatEnabled', config.wechat.enabled);
                    updateConfigDisplay('wechatOrderEnabled', config.wechat.orderStatusEnabled);
                    
                    // æ›´æ–°ç«™å†…æ¶ˆæ¯é…ç½®æ˜¾ç¤º
                    updateConfigDisplay('inAppEnabled', config.inApp.enabled);
                    updateConfigDisplay('inAppOrderEnabled', config.inApp.orderStatusEnabled);
                    
                    showResult('configResult', 'é…ç½®å·²åˆ·æ–°', 'success');
                } else {
                    showResult('configResult', `è·å–é…ç½®å¤±è´¥: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult('configResult', `è·å–é…ç½®å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        // æ›´æ–°é…ç½®æ˜¾ç¤º
        function updateConfigDisplay(elementId, enabled) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = enabled ? 'å¯ç”¨' : 'ç¦ç”¨';
                element.className = `config-value ${enabled ? 'enabled' : 'disabled'}`;
            }
        }

        // ç”Ÿæˆé…ç½®æ–‡ä»¶
        function generateConfigYaml() {
            const scenario = document.getElementById('configScenario').value;
            let config = '';

            switch (scenario) {
                case 'all-enabled':
                    config = `notification:
  sms:
    enabled: true
    order-status-enabled: true
    verification-enabled: true
  email:
    enabled: true
    order-status-enabled: true
  wechat:
    enabled: true
    order-status-enabled: true
  in-app:
    enabled: true
    order-status-enabled: true`;
                    break;
                case 'sms-only':
                    config = `notification:
  sms:
    enabled: true
    order-status-enabled: true
    verification-enabled: true
  email:
    enabled: false
    order-status-enabled: false
  wechat:
    enabled: false
    order-status-enabled: false
  in-app:
    enabled: false
    order-status-enabled: false`;
                    break;
                case 'sms-disabled':
                    config = `notification:
  sms:
    enabled: false
    order-status-enabled: false
    verification-enabled: false
  email:
    enabled: true
    order-status-enabled: true
  wechat:
    enabled: true
    order-status-enabled: true
  in-app:
    enabled: true
    order-status-enabled: true`;
                    break;
                case 'order-disabled':
                    config = `notification:
  sms:
    enabled: true
    order-status-enabled: false
    verification-enabled: true
  email:
    enabled: true
    order-status-enabled: false
  wechat:
    enabled: true
    order-status-enabled: false
  in-app:
    enabled: true
    order-status-enabled: false`;
                    break;
                case 'all-disabled':
                    config = `notification:
  sms:
    enabled: false
    order-status-enabled: false
    verification-enabled: false
  email:
    enabled: false
    order-status-enabled: false
  wechat:
    enabled: false
    order-status-enabled: false
  in-app:
    enabled: false
    order-status-enabled: false`;
                    break;
            }

            showResult('configResult', `ç”Ÿæˆçš„é…ç½®æ–‡ä»¶å†…å®¹ï¼š\n\n${config}\n\nè¯·å°†æ­¤é…ç½®å¤åˆ¶åˆ° application.yml æ–‡ä»¶ä¸­ï¼Œç„¶åé‡å¯æœåŠ¡ä»¥æµ‹è¯•æ•ˆæœã€‚`, 'info');
        }

        // æ˜¾ç¤ºå½“å‰é…ç½®
        function showCurrentYaml() {
            const currentConfig = `notification:
  sms:
    enabled: true
    order-status-enabled: true
    verification-enabled: true
  email:
    enabled: false
    order-status-enabled: false
  wechat:
    enabled: false
    order-status-enabled: false
  in-app:
    enabled: true
    order-status-enabled: true`;

            showResult('configResult', `å½“å‰ application.yml é…ç½®ï¼š\n\n${currentConfig}`, 'info');
        }

        // æµ‹è¯•SMSé€šçŸ¥
        async function testSmsNotification() {
            const phone = document.getElementById('testPhone').value;
            const message = document.getElementById('testMessage').value;

            if (!phone || !message) {
                showResult('testResult', 'è¯·å¡«å†™æ‰‹æœºå·å’Œæ¶ˆæ¯å†…å®¹', 'error');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('phone', phone);
                formData.append('message', message);

                const response = await fetch(`${API_BASE}/notification-test/test-sms`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    showResult('testResult', `SMSé€šçŸ¥æµ‹è¯•æˆåŠŸï¼š\n${result.data}`, 'success');
                    addLog(`[SMS] æµ‹è¯•æˆåŠŸ - ${phone}: ${message}`);
                } else {
                    showResult('testResult', `SMSé€šçŸ¥æµ‹è¯•å¤±è´¥ï¼š\n${result.message}`, 'warning');
                    addLog(`[SMS] æµ‹è¯•å¤±è´¥ - ${result.message}`);
                }

            } catch (error) {
                showResult('testResult', `SMSé€šçŸ¥æµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
                addLog(`[SMS] æµ‹è¯•å¼‚å¸¸ - ${error.message}`);
            }
        }

        // æµ‹è¯•é‚®ä»¶é€šçŸ¥
        async function testEmailNotification() {
            const message = document.getElementById('testMessage').value;

            if (!message) {
                showResult('testResult', 'è¯·å¡«å†™æ¶ˆæ¯å†…å®¹', 'error');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('email', 'test@example.com');
                formData.append('subject', 'æµ‹è¯•é‚®ä»¶é€šçŸ¥');
                formData.append('content', message);

                const response = await fetch(`${API_BASE}/notification-test/test-email`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    showResult('testResult', `é‚®ä»¶é€šçŸ¥æµ‹è¯•æˆåŠŸï¼š\n${result.data}`, 'success');
                    addLog(`[EMAIL] æµ‹è¯•æˆåŠŸ - test@example.com: ${message}`);
                } else {
                    showResult('testResult', `é‚®ä»¶é€šçŸ¥æµ‹è¯•å¤±è´¥ï¼š\n${result.message}`, 'warning');
                    addLog(`[EMAIL] æµ‹è¯•å¤±è´¥ - ${result.message}`);
                }

            } catch (error) {
                showResult('testResult', `é‚®ä»¶é€šçŸ¥æµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
                addLog(`[EMAIL] æµ‹è¯•å¼‚å¸¸ - ${error.message}`);
            }
        }

        // æµ‹è¯•å¾®ä¿¡é€šçŸ¥
        async function testWechatNotification() {
            const message = document.getElementById('testMessage').value;

            if (!message) {
                showResult('testResult', 'è¯·å¡«å†™æ¶ˆæ¯å†…å®¹', 'error');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('openId', 'test_openid_123');
                formData.append('message', message);

                const response = await fetch(`${API_BASE}/notification-test/test-wechat`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    showResult('testResult', `å¾®ä¿¡é€šçŸ¥æµ‹è¯•æˆåŠŸï¼š\n${result.data}`, 'success');
                    addLog(`[WECHAT] æµ‹è¯•æˆåŠŸ - test_openid_123: ${message}`);
                } else {
                    showResult('testResult', `å¾®ä¿¡é€šçŸ¥æµ‹è¯•å¤±è´¥ï¼š\n${result.message}`, 'warning');
                    addLog(`[WECHAT] æµ‹è¯•å¤±è´¥ - ${result.message}`);
                }

            } catch (error) {
                showResult('testResult', `å¾®ä¿¡é€šçŸ¥æµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
                addLog(`[WECHAT] æµ‹è¯•å¼‚å¸¸ - ${error.message}`);
            }
        }

        // æµ‹è¯•ç«™å†…æ¶ˆæ¯
        async function testInAppNotification() {
            const message = document.getElementById('testMessage').value;

            if (!message) {
                showResult('testResult', 'è¯·å¡«å†™æ¶ˆæ¯å†…å®¹', 'error');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('userId', '1001');
                formData.append('title', 'ç³»ç»Ÿé€šçŸ¥');
                formData.append('content', message);

                const response = await fetch(`${API_BASE}/notification-test/test-in-app`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    showResult('testResult', `ç«™å†…æ¶ˆæ¯æµ‹è¯•æˆåŠŸï¼š\n${result.data}`, 'success');
                    addLog(`[IN-APP] æµ‹è¯•æˆåŠŸ - ç”¨æˆ·1001: ${message}`);
                } else {
                    showResult('testResult', `ç«™å†…æ¶ˆæ¯æµ‹è¯•å¤±è´¥ï¼š\n${result.message}`, 'warning');
                    addLog(`[IN-APP] æµ‹è¯•å¤±è´¥ - ${result.message}`);
                }

            } catch (error) {
                showResult('testResult', `ç«™å†…æ¶ˆæ¯æµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
                addLog(`[IN-APP] æµ‹è¯•å¼‚å¸¸ - ${error.message}`);
            }
        }

        // å¼€å§‹æ—¥å¿—ç›‘æ§
        function startLogMonitoring() {
            document.getElementById('logViewer').style.display = 'block';
            addLog('å¼€å§‹ç›‘æ§åç«¯æ—¥å¿—...');
            
            // æ¨¡æ‹Ÿæ—¥å¿—ç›‘æ§
            logMonitorInterval = setInterval(() => {
                const timestamp = new Date().toLocaleTimeString();
                addLog(`[${timestamp}] ç³»ç»Ÿè¿è¡Œæ­£å¸¸ï¼Œç­‰å¾…é€šçŸ¥äº‹ä»¶...`);
            }, 5000);
        }

        // åœæ­¢æ—¥å¿—ç›‘æ§
        function stopLogMonitoring() {
            if (logMonitorInterval) {
                clearInterval(logMonitorInterval);
                logMonitorInterval = null;
                addLog('æ—¥å¿—ç›‘æ§å·²åœæ­¢');
            }
        }

        // æ¸…ç©ºæ—¥å¿—
        function clearLogs() {
            document.getElementById('logContent').innerHTML = 'æ—¥å¿—å·²æ¸…ç©º';
        }

        // æ·»åŠ æ—¥å¿—
        function addLog(message) {
            const logContent = document.getElementById('logContent');
            const timestamp = new Date().toLocaleTimeString();
            logContent.innerHTML += `\n[${timestamp}] ${message}`;
            logContent.scrollTop = logContent.scrollHeight;
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `result ${type}`;
            element.style.display = 'block';
        }

        // æµ‹è¯•è®¢å•çŠ¶æ€é€šçŸ¥
        async function testOrderStatusNotification() {
            const orderNo = document.getElementById('orderNo').value;
            const oldStatus = document.getElementById('oldStatus').value;
            const newStatus = document.getElementById('newStatus').value;
            
            if (!orderNo || !oldStatus || !newStatus) {
                alert('è¯·å¡«å†™å®Œæ•´çš„è®¢å•ä¿¡æ¯');
                return;
            }
            
            try {
                const formData = new FormData();
                formData.append('phone', '13800138000');
                formData.append('orderNo', orderNo);
                formData.append('oldStatus', oldStatus);
                formData.append('newStatus', newStatus);
                formData.append('customerName', 'æµ‹è¯•ç”¨æˆ·');
                
                const response = await fetch('http://localhost:8080/api/notification-test/test-order-status', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                document.getElementById('orderResult').innerHTML = 
                    `<div style="color: ${result.success ? 'green' : 'red'}">
                        ${result.success ? result.data : result.message}
                    </div>`;
                
                console.log('è®¢å•çŠ¶æ€é€šçŸ¥æµ‹è¯•ç»“æœ:', result);
            } catch (error) {
                document.getElementById('orderResult').innerHTML = 
                    `<div style="color: red">è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
                console.error('è®¢å•çŠ¶æ€é€šçŸ¥æµ‹è¯•å¤±è´¥:', error);
            }
        }

        // ç”Ÿæˆé…ç½®æµ‹è¯•æŠ¥å‘Š
        async function generateTestReport() {
            try {
                const response = await fetch(`${API_BASE}/notification-test/config-test-report`);
                const result = await response.json();
                
                if (result.code === 200) {
                    const report = result.data;
                    const timestamp = new Date(report.timestamp).toLocaleString();
                    
                    let reportHtml = `
                        <h4>é…ç½®æµ‹è¯•æŠ¥å‘Š - ${timestamp}</h4>
                        <div style="margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 5px;">
                            <strong>æµ‹è¯•æ‘˜è¦:</strong><br>
                            æ€»é…ç½®æ•°: ${report.summary.totalConfigs}<br>
                            å·²å¯ç”¨: ${report.summary.enabledConfigs}<br>
                            å·²ç¦ç”¨: ${report.summary.disabledConfigs}<br>
                            å¯ç”¨ç‡: ${report.summary.enabledPercentage.toFixed(1)}%
                        </div>
                        <div style="margin: 10px 0;">
                            <strong>è¯¦ç»†é…ç½®çŠ¶æ€:</strong><br>
                    `;
                    
                    // æ·»åŠ å„ä¸ªé…ç½®çš„è¯¦ç»†çŠ¶æ€
                    const testResults = report.testResults;
                    for (const [type, config] of Object.entries(testResults)) {
                        const typeName = {
                            'sms': 'SMSçŸ­ä¿¡',
                            'email': 'é‚®ä»¶',
                            'wechat': 'å¾®ä¿¡',
                            'inApp': 'ç«™å†…æ¶ˆæ¯'
                        }[type] || type;
                        
                        reportHtml += `
                            <div style="margin: 5px 0; padding: 5px; border-left: 3px solid ${config.enabled ? '#4CAF50' : '#f44336'};">
                                <strong>${typeName}:</strong> ${config.status}<br>
                                - åŸºç¡€åŠŸèƒ½: ${config.enabled ? 'å¯ç”¨' : 'ç¦ç”¨'}<br>
                                - è®¢å•çŠ¶æ€é€šçŸ¥: ${config.orderStatusEnabled ? 'å¯ç”¨' : 'ç¦ç”¨'}
                                ${config.verificationEnabled !== undefined ? `<br>- éªŒè¯ç é€šçŸ¥: ${config.verificationEnabled ? 'å¯ç”¨' : 'ç¦ç”¨'}` : ''}
                            </div>
                        `;
                    }
                    
                    reportHtml += '</div>';
                    
                    document.getElementById('reportResult').innerHTML = reportHtml;
                    addLog(`[REPORT] é…ç½®æµ‹è¯•æŠ¥å‘Šç”ŸæˆæˆåŠŸ`);
                    console.log('æµ‹è¯•æŠ¥å‘Š:', report);
                } else {
                    document.getElementById('reportResult').innerHTML = 
                        `<div style="color: red">æŠ¥å‘Šç”Ÿæˆå¤±è´¥: ${result.message}</div>`;
                    addLog(`[REPORT] æŠ¥å‘Šç”Ÿæˆå¤±è´¥ - ${result.message}`);
                }
            } catch (error) {
                document.getElementById('reportResult').innerHTML = 
                    `<div style="color: red">æŠ¥å‘Šç”Ÿæˆå¼‚å¸¸: ${error.message}</div>`;
                addLog(`[REPORT] æŠ¥å‘Šç”Ÿæˆå¼‚å¸¸ - ${error.message}`);
                console.error('æŠ¥å‘Šç”Ÿæˆå¤±è´¥:', error);
            }
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.onload = function() {
            console.log('é€šçŸ¥é…ç½®å¼€å…³æµ‹è¯•é¡µé¢å·²åŠ è½½');
            refreshConfig();
        };
    </script>
</body>
</html>