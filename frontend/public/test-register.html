<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³¨å†ŒåŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }
        .sms-group {
            display: flex;
            gap: 10px;
        }
        .sms-group input {
            flex: 1;
        }
        button {
            background: #409eff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background: #337ecc;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .register-btn {
            width: 100%;
            margin-top: 20px;
            padding: 15px;
            font-size: 18px;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        .success {
            background: #f0f9ff;
            border: 1px solid #409eff;
            color: #409eff;
        }
        .error {
            background: #fef0f0;
            border: 1px solid #f56c6c;
            color: #f56c6c;
        }
        .test-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .test-btn {
            margin: 5px;
            padding: 8px 15px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš— æ³¨å†ŒåŠŸèƒ½æµ‹è¯•</h1>
        
        <form id="registerForm">
            <div class="form-group">
                <label for="username">ç”¨æˆ·å:</label>
                <input type="text" id="username" name="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·åï¼ˆ3-20ä¸ªå­—ç¬¦ï¼‰" required>
            </div>
            
            <div class="form-group">
                <label for="realName">çœŸå®å§“å:</label>
                <input type="text" id="realName" name="realName" placeholder="è¯·è¾“å…¥çœŸå®å§“å" required>
            </div>
            
            <div class="form-group">
                <label for="phone">æ‰‹æœºå·:</label>
                <input type="tel" id="phone" name="phone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" required>
            </div>
            
            <div class="form-group">
                <label for="smsCode">çŸ­ä¿¡éªŒè¯ç :</label>
                <div class="sms-group">
                    <input type="text" id="smsCode" name="smsCode" placeholder="è¯·è¾“å…¥6ä½éªŒè¯ç " required>
                    <button type="button" id="sendSmsBtn" onclick="sendSmsCode()">è·å–éªŒè¯ç </button>
                </div>
            </div>
            
            <div class="form-group">
                <label for="email">é‚®ç®±:</label>
                <input type="email" id="email" name="email" placeholder="è¯·è¾“å…¥é‚®ç®±ï¼ˆå¯é€‰ï¼‰">
            </div>
            
            <div class="form-group">
                <label for="password">å¯†ç :</label>
                <input type="password" id="password" name="password" placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆ6-20ä¸ªå­—ç¬¦ï¼‰" required>
            </div>
            
            <div class="form-group">
                <label for="confirmPassword">ç¡®è®¤å¯†ç :</label>
                <input type="password" id="confirmPassword" name="confirmPassword" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç " required>
            </div>
            
            <button type="submit" class="register-btn" id="registerBtn">æ³¨å†Œ</button>
        </form>
        
        <div id="result" class="result"></div>
        
        <div class="test-section">
            <h3>ğŸ§ª å¿«é€Ÿæµ‹è¯•</h3>
            <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®è¿›è¡Œå¿«é€Ÿæµ‹è¯•ï¼š</p>
            <button class="test-btn" onclick="fillTestData()">å¡«å……æµ‹è¯•æ•°æ®</button>
            <button class="test-btn" onclick="testUsernameCheck()">æµ‹è¯•ç”¨æˆ·åæ£€æŸ¥</button>
            <button class="test-btn" onclick="testPhoneCheck()">æµ‹è¯•æ‰‹æœºå·æ£€æŸ¥</button>
            <button class="test-btn" onclick="clearForm()">æ¸…ç©ºè¡¨å•</button>
        </div>
    </div>

    <script>
        let smsCountdown = 0;
        let smsTimer = null;

        // å‘é€çŸ­ä¿¡éªŒè¯ç 
        async function sendSmsCode() {
            const phone = document.getElementById('phone').value;
            if (!phone) {
                showResult('è¯·å…ˆè¾“å…¥æ‰‹æœºå·', 'error');
                return;
            }

            if (!/^1[3-9]\d{9}$/.test(phone)) {
                showResult('æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®', 'error');
                return;
            }

            const sendBtn = document.getElementById('sendSmsBtn');
            sendBtn.disabled = true;
            sendBtn.textContent = 'å‘é€ä¸­...';

            try {
                const response = await fetch('http://localhost:8080/api/sms/send-register-code', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `phone=${encodeURIComponent(phone)}`
                });

                const result = await response.json();
                
                if (result.code === 200) {
                    showResult('éªŒè¯ç å‘é€æˆåŠŸï¼è¯·æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—è·å–éªŒè¯ç ', 'success');
                    startSmsCountdown();
                } else {
                    showResult(result.message || 'éªŒè¯ç å‘é€å¤±è´¥', 'error');
                    sendBtn.disabled = false;
                    sendBtn.textContent = 'è·å–éªŒè¯ç ';
                }
            } catch (error) {
                console.error('å‘é€éªŒè¯ç å¤±è´¥:', error);
                showResult('å‘é€éªŒè¯ç å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
                sendBtn.disabled = false;
                sendBtn.textContent = 'è·å–éªŒè¯ç ';
            }
        }

        // å¼€å§‹çŸ­ä¿¡å€’è®¡æ—¶
        function startSmsCountdown() {
            smsCountdown = 60;
            const sendBtn = document.getElementById('sendSmsBtn');
            
            smsTimer = setInterval(() => {
                smsCountdown--;
                sendBtn.textContent = `${smsCountdown}såé‡æ–°è·å–`;
                
                if (smsCountdown <= 0) {
                    clearInterval(smsTimer);
                    sendBtn.disabled = false;
                    sendBtn.textContent = 'è·å–éªŒè¯ç ';
                }
            }, 1000);
        }

        // æ³¨å†Œè¡¨å•æäº¤
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const registerData = {
                username: formData.get('username'),
                realName: formData.get('realName'),
                phone: formData.get('phone'),
                email: formData.get('email'),
                password: formData.get('password'),
                confirmPassword: formData.get('confirmPassword'),
                smsCode: formData.get('smsCode')
            };

            // å‰ç«¯éªŒè¯
            if (registerData.password !== registerData.confirmPassword) {
                showResult('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´', 'error');
                return;
            }

            const registerBtn = document.getElementById('registerBtn');
            registerBtn.disabled = true;
            registerBtn.textContent = 'æ³¨å†Œä¸­...';

            try {
                const response = await fetch('http://localhost:8080/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(registerData)
                });

                const result = await response.json();
                
                if (result.code === 200) {
                    showResult('æ³¨å†ŒæˆåŠŸï¼', 'success');
                    document.getElementById('registerForm').reset();
                } else {
                    showResult(result.message || 'æ³¨å†Œå¤±è´¥', 'error');
                }
            } catch (error) {
                console.error('æ³¨å†Œå¤±è´¥:', error);
                showResult('æ³¨å†Œå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
            } finally {
                registerBtn.disabled = false;
                registerBtn.textContent = 'æ³¨å†Œ';
            }
        });

        // æ˜¾ç¤ºç»“æœ
        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = message;
            resultDiv.className = `result ${type}`;
            resultDiv.style.display = 'block';
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                resultDiv.style.display = 'none';
            }, 3000);
        }

        // å¡«å……æµ‹è¯•æ•°æ®
        function fillTestData() {
            const timestamp = Date.now().toString().slice(-6);
            document.getElementById('username').value = `testuser${timestamp}`;
            document.getElementById('realName').value = 'æµ‹è¯•ç”¨æˆ·';
            document.getElementById('phone').value = `138${timestamp.padStart(8, '0')}`;
            document.getElementById('email').value = `test${timestamp}@example.com`;
            document.getElementById('password').value = '123456';
            document.getElementById('confirmPassword').value = '123456';
            document.getElementById('smsCode').value = '123456';
            showResult('æµ‹è¯•æ•°æ®å·²å¡«å……', 'success');
        }

        // æµ‹è¯•ç”¨æˆ·åæ£€æŸ¥
        async function testUsernameCheck() {
            const username = document.getElementById('username').value;
            if (!username) {
                showResult('è¯·å…ˆè¾“å…¥ç”¨æˆ·å', 'error');
                return;
            }

            try {
                const response = await fetch(`http://localhost:8080/api/auth/check-username?username=${encodeURIComponent(username)}`);
                const result = await response.json();
                
                if (result.code === 200) {
                    const available = result.data;
                    showResult(available ? 'ç”¨æˆ·åå¯ç”¨' : 'ç”¨æˆ·åå·²å­˜åœ¨', available ? 'success' : 'error');
                } else {
                    showResult(result.message || 'æ£€æŸ¥å¤±è´¥', 'error');
                }
            } catch (error) {
                console.error('æ£€æŸ¥ç”¨æˆ·åå¤±è´¥:', error);
                showResult('æ£€æŸ¥ç”¨æˆ·åå¤±è´¥', 'error');
            }
        }

        // æµ‹è¯•æ‰‹æœºå·æ£€æŸ¥
        async function testPhoneCheck() {
            const phone = document.getElementById('phone').value;
            if (!phone) {
                showResult('è¯·å…ˆè¾“å…¥æ‰‹æœºå·', 'error');
                return;
            }

            try {
                // æ³¨æ„ï¼šè¿™ä¸ªAPIå¯èƒ½ä¸å­˜åœ¨ï¼Œéœ€è¦åœ¨åç«¯æ·»åŠ 
                const response = await fetch(`http://localhost:8080/api/auth/check-phone?phone=${encodeURIComponent(phone)}`);
                const result = await response.json();
                
                if (result.code === 200) {
                    const available = result.data;
                    showResult(available ? 'æ‰‹æœºå·å¯ç”¨' : 'æ‰‹æœºå·å·²æ³¨å†Œ', available ? 'success' : 'error');
                } else {
                    showResult(result.message || 'æ£€æŸ¥å¤±è´¥', 'error');
                }
            } catch (error) {
                console.error('æ£€æŸ¥æ‰‹æœºå·å¤±è´¥:', error);
                showResult('æ£€æŸ¥æ‰‹æœºå·å¤±è´¥ï¼ˆAPIå¯èƒ½ä¸å­˜åœ¨ï¼‰', 'error');
            }
        }

        // æ¸…ç©ºè¡¨å•
        function clearForm() {
            document.getElementById('registerForm').reset();
            showResult('è¡¨å•å·²æ¸…ç©º', 'success');
        }
    </script>
</body>
</html>