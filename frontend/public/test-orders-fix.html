<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ordersé¡µé¢ä¿®å¤éªŒè¯</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ordersé¡µé¢ä¿®å¤éªŒè¯æµ‹è¯•</h1>
        
        <div class="test-section info">
            <h3>ğŸ” æµ‹è¯•ç›®æ ‡</h3>
            <p>éªŒè¯ä»¥ä¸‹ä¿®å¤æ˜¯å¦æˆåŠŸï¼š</p>
            <ul>
                <li>âœ… ä¿®å¤enhancedWebSocket.jsä¸­çš„è®¤è¯é€»è¾‘é”™è¯¯</li>
                <li>âœ… ä¿®å¤WebSocketä¸­å¯¹userStoreçš„é”™è¯¯ä½¿ç”¨</li>
                <li>âœ… ä¿®å¤Orders.vueä¸­ç™»å½•æˆåŠŸåæœªæ›´æ–°userStoreçŠ¶æ€çš„é—®é¢˜</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>ğŸ§ª æµ‹è¯•æ­¥éª¤</h3>
            <button onclick="clearStorage()">1. æ¸…é™¤å­˜å‚¨</button>
            <button onclick="testLogin()">2. æµ‹è¯•ç™»å½•</button>
            <button onclick="checkUserStore()">3. æ£€æŸ¥UserStore</button>
            <button onclick="testWebSocket()">4. æµ‹è¯•WebSocket</button>
            <button onclick="openOrdersPage()">5. æ‰“å¼€Ordersé¡µé¢</button>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
            <div id="results"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“ æµ‹è¯•æ—¥å¿—</h3>
            <div id="log" class="log"></div>
        </div>
    </div>

    <script>
        let logElement = document.getElementById('log');
        let resultsElement = document.getElementById('results');

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function showResult(title, success, message) {
            const div = document.createElement('div');
            div.className = `test-section ${success ? 'success' : 'error'}`;
            div.innerHTML = `<strong>${title}:</strong> ${message}`;
            resultsElement.appendChild(div);
        }

        function clearStorage() {
            localStorage.clear();
            sessionStorage.clear();
            log('âœ… å·²æ¸…é™¤æ‰€æœ‰å­˜å‚¨æ•°æ®');
            showResult('æ¸…é™¤å­˜å‚¨', true, 'æœ¬åœ°å­˜å‚¨å·²æ¸…ç©º');
        }

        async function testLogin() {
            try {
                log('ğŸ” å¼€å§‹æµ‹è¯•ç™»å½•...');
                
                const response = await fetch('http://localhost:8080/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'admin123'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.code === 200 && data.data.token) {
                        localStorage.setItem('token', data.data.token);
                        localStorage.setItem('tokenType', 'Bearer');
                        if (data.data.user) {
                            localStorage.setItem('userInfo', JSON.stringify(data.data.user));
                            localStorage.setItem('userRole', data.data.user.role);
                        }
                        log('âœ… ç™»å½•æˆåŠŸï¼Œtokenå·²ä¿å­˜');
                        showResult('ç™»å½•æµ‹è¯•', true, 'æˆåŠŸè·å–tokenå¹¶ä¿å­˜åˆ°localStorage');
                        return true;
                    }
                }
                throw new Error('ç™»å½•å¤±è´¥');
            } catch (error) {
                log(`âŒ ç™»å½•å¤±è´¥: ${error.message}`);
                showResult('ç™»å½•æµ‹è¯•', false, error.message);
                return false;
            }
        }

        function checkUserStore() {
            log('ğŸ” æ£€æŸ¥UserStoreçŠ¶æ€...');
            
            // æ£€æŸ¥localStorageä¸­çš„æ•°æ®
            const token = localStorage.getItem('token');
            const userInfo = localStorage.getItem('userInfo');
            
            if (token && userInfo) {
                log('âœ… localStorageä¸­æœ‰tokenå’Œç”¨æˆ·ä¿¡æ¯');
                log(`Token: ${token.substring(0, 20)}...`);
                log(`UserInfo: ${userInfo}`);
                showResult('UserStoreæ£€æŸ¥', true, 'localStorageä¸­åŒ…å«å¿…è¦çš„è®¤è¯ä¿¡æ¯');
            } else {
                log('âŒ localStorageä¸­ç¼ºå°‘è®¤è¯ä¿¡æ¯');
                showResult('UserStoreæ£€æŸ¥', false, 'localStorageä¸­ç¼ºå°‘tokenæˆ–ç”¨æˆ·ä¿¡æ¯');
            }
        }

        function testWebSocket() {
            log('ğŸ”Œ æµ‹è¯•WebSocketè¿æ¥é€»è¾‘...');
            
            // æ¨¡æ‹Ÿæ£€æŸ¥è®¤è¯çŠ¶æ€
            const token = localStorage.getItem('token');
            const userInfo = localStorage.getItem('userInfo');
            
            if (token && userInfo) {
                try {
                    const user = JSON.parse(userInfo);
                    if (user && user.id) {
                        log('âœ… WebSocketè®¤è¯æ£€æŸ¥é€šè¿‡');
                        log(`ç”¨æˆ·ID: ${user.id}`);
                        showResult('WebSocketæµ‹è¯•', true, 'è®¤è¯ä¿¡æ¯å®Œæ•´ï¼ŒWebSocketå¯ä»¥æ­£å¸¸è¿æ¥');
                    } else {
                        throw new Error('ç”¨æˆ·ä¿¡æ¯ä¸­ç¼ºå°‘ID');
                    }
                } catch (error) {
                    log(`âŒ ç”¨æˆ·ä¿¡æ¯è§£æå¤±è´¥: ${error.message}`);
                    showResult('WebSocketæµ‹è¯•', false, `ç”¨æˆ·ä¿¡æ¯è§£æå¤±è´¥: ${error.message}`);
                }
            } else {
                log('âŒ WebSocketè®¤è¯æ£€æŸ¥å¤±è´¥ï¼šç¼ºå°‘è®¤è¯ä¿¡æ¯');
                showResult('WebSocketæµ‹è¯•', false, 'ç¼ºå°‘tokenæˆ–ç”¨æˆ·ä¿¡æ¯ï¼ŒWebSocketæ— æ³•è¿æ¥');
            }
        }

        function openOrdersPage() {
            log('ğŸš€ æ‰“å¼€Ordersé¡µé¢...');
            window.open('http://localhost:3000/orders', '_blank');
            showResult('æ‰“å¼€Ordersé¡µé¢', true, 'å·²åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€Ordersé¡µé¢ï¼Œè¯·æ£€æŸ¥æ˜¯å¦æœ‰"ç”¨æˆ·æœªç™»å½•"é”™è¯¯');
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.onload = function() {
            log('ğŸ¯ Ordersé¡µé¢ä¿®å¤éªŒè¯æµ‹è¯•å·²å¯åŠ¨');
            log('è¯·æŒ‰é¡ºåºæ‰§è¡Œæµ‹è¯•æ­¥éª¤ï¼ŒéªŒè¯ä¿®å¤æ•ˆæœ');
        };
    </script>
</body>
</html>