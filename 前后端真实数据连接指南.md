# 前后端真实数据连接指南

## 📋 概述

本指南将帮助您将前后端系统连接，使用数据库中的真实数据替换虚拟Mock数据，实现完整的数据流转。

## 🚀 快速启动

### 方法一：使用启动脚本（推荐）

1. **双击运行启动脚本**
   ```
   start-services.bat
   ```

2. **等待服务启动完成**
   - 后端服务：http://localhost:8080
   - 前端服务：http://localhost:3000
   - 真实数据测试页面：http://localhost:3000/real-data-test

### 方法二：手动启动

1. **启动MySQL数据库**
   ```bash
   net start mysql
   ```

2. **初始化测试数据**
   ```bash
   mysql -u root -p < sql/init.sql
   mysql -u root -p < sql/test_data.sql
   ```

3. **启动后端服务**
   ```bash
   cd backend
   mvn spring-boot:run
   ```

4. **启动前端服务**
   ```bash
   cd frontend
   npm run dev
   ```

## 🔧 配置说明

### 前端配置

1. **API配置文件**：`frontend/src/config/api.js`
   ```javascript
   export const API_CONFIG = {
     USE_REAL_API: true,  // 强制使用真实API
     BASE_URL: 'http://localhost:8080/api',
     TIMEOUT: 10000
   }
   ```

2. **环境变量**：`frontend/.env`
   ```
   VITE_USE_REAL_API=true
   ```

3. **请求拦截器**：`frontend/src/api/request.js`
   - 自动添加JWT Token
   - 统一错误处理
   - 请求/响应日志

### 后端配置

1. **数据库连接**：`backend/src/main/resources/application.yml`
   ```yaml
   spring:
     datasource:
       url: jdbc:mysql://localhost:3306/carwash_db
       username: root
       password: 123456
   ```

2. **API端点**：所有API都在 `/api` 路径下
   - 认证：`/api/auth/*`
   - 用户：`/api/user/*`
   - 服务：`/api/services/*`
   - 预约：`/api/bookings/*`
   - 统计：`/api/statistics/*`

## 📊 数据库数据

### 测试账号
| 用户名 | 密码 | 角色 | 说明 |
|--------|------|------|------|
| admin | admin123 | 管理员 | 系统管理员账号 |
| user001 | user123 | 用户 | 普通用户账号 |
| testuser1 | test123 | 用户 | 测试用户1 |
| testuser2 | test123 | 用户 | 测试用户2 |

### 数据统计
- **用户数据**：6条记录（包含管理员和测试用户）
- **服务数据**：11条记录（涵盖基础、精致、豪华、专项服务）
- **时间段数据**：480条记录（未来30天，每天16个时间段）
- **预约数据**：5条记录（不同状态的测试订单）
- **反馈数据**：3条记录（用户评价）

### 服务项目
1. **基础服务**
   - 快速洗车：¥20（20分钟）
   - 基础洗车：¥30（30分钟）
   - 标准洗车：¥35（35分钟）

2. **精致服务**
   - 精致洗车：¥50（45分钟）
   - 高级洗车：¥55（50分钟）

3. **豪华服务**
   - 豪华洗车：¥80（60分钟）
   - 至尊洗车：¥100（90分钟）

4. **专项服务**
   - 内饰深度清洁：¥60（40分钟）
   - 车身打蜡：¥40（30分钟）
   - 发动机清洗：¥80（45分钟）
   - 轮胎保养：¥45（25分钟）

## 🧪 测试功能

### 1. 真实数据测试页面

访问：http://localhost:3000/real-data-test

**功能包括**：
- 后端连接状态检测
- 数据库连接测试
- 用户认证测试
- 数据库数据查看
- API响应日志

### 2. 主要功能测试

1. **用户认证**
   - 登录/注册功能
   - JWT Token验证
   - 权限控制

2. **数据展示**
   - 用户列表（管理员功能）
   - 服务列表
   - 预约订单管理
   - 统计数据可视化

3. **业务流程**
   - 服务预约流程
   - 订单状态管理
   - 用户信息管理

## 🔍 API接口测试

### 健康检查
```bash
curl http://localhost:8080/api/test/health
```

### 用户登录
```bash
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

### 获取服务列表
```bash
curl http://localhost:8080/api/services/list \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 获取统计数据
```bash
curl http://localhost:8080/api/statistics/overview \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## 🐛 常见问题

### 1. 后端启动失败
**问题**：端口8080被占用
**解决**：
```bash
netstat -ano | findstr :8080
taskkill /PID <PID> /F
```

### 2. 数据库连接失败
**问题**：MySQL服务未启动
**解决**：
```bash
net start mysql
```

### 3. 前端API请求失败
**问题**：跨域或网络错误
**解决**：
- 检查后端服务是否正常运行
- 确认API地址配置正确
- 查看浏览器控制台错误信息

### 4. 登录失败
**问题**：用户名或密码错误
**解决**：
- 使用测试账号：admin/admin123
- 检查数据库中用户数据是否正确

## 📈 性能监控

### 1. API响应时间
- 正常响应时间：< 500ms
- 数据库查询：< 200ms
- 文件上传：< 2s

### 2. 系统资源
- 内存使用：< 1GB
- CPU使用：< 50%
- 数据库连接：< 20个

## 🔒 安全说明

### 1. 数据安全
- 密码采用明文存储（仅用于开发测试）
- 生产环境需要加密存储
- JWT Token有效期设置

### 2. API安全
- 接口权限验证
- 参数校验
- SQL注入防护

## 📝 开发说明

### 1. 添加新API
1. 后端：创建Controller和Service
2. 前端：在realApi.js中添加接口
3. 更新API配置文件

### 2. 数据库变更
1. 修改SQL脚本
2. 更新实体类
3. 测试数据迁移

### 3. 前端组件
1. 使用真实API替换Mock数据
2. 添加错误处理
3. 优化用户体验

## 🎯 下一步计划

1. **性能优化**
   - Redis缓存集成
   - 数据库索引优化
   - 前端代码分割

2. **功能扩展**
   - 支付系统集成
   - 消息通知系统
   - 数据导出功能

3. **部署上线**
   - Docker容器化
   - CI/CD流水线
   - 生产环境配置

---

**更新时间**：2025年10月25日  
**版本**：v1.0.0  
**状态**：前后端真实数据连接完成