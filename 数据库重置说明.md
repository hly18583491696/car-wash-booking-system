# 数据库重置说明

## 概述
本文档说明如何清空并重新初始化汽车洗车服务预约系统的数据库。

## 文件说明

### 1. SQL脚本文件
- **`sql/reset_database.sql`** - 数据库重置脚本
  - 清空所有表数据
  - 重置自增ID
  - 插入初始化数据

### 2. 批处理脚本
- **`reset-database.bat`** - 快速重置脚本
- **`reset-database-safe.bat`** - 安全重置脚本（推荐）
  - 包含数据备份功能
  - 需要用户确认
  - 详细的操作日志

## 使用方法

### 方法一：使用安全重置脚本（推荐）
```bash
# 双击运行或在命令行执行
reset-database-safe.bat
```

**特点：**
- ✅ 自动备份现有数据
- ✅ 需要用户确认操作
- ✅ 详细的操作反馈
- ✅ 错误处理和建议

### 方法二：使用快速重置脚本
```bash
# 双击运行或在命令行执行
reset-database.bat
```

**特点：**
- ⚡ 快速执行
- ⚠️ 无备份功能
- ⚠️ 无确认步骤

### 方法三：手动执行SQL脚本
```bash
# 在MySQL命令行中执行
mysql -u root -p123456 -h localhost -P 3306 < sql/reset_database.sql
```

## 重置后的数据

### 用户账号
| 用户名 | 密码 | 角色 | 姓名 |
|--------|------|------|------|
| admin | admin123 | admin | 系统管理员 |
| user001 | user123 | user | 张三 |
| testuser1 | test123 | user | 李四 |
| testuser2 | test123 | user | 王五 |
| manager | manager123 | admin | 店长 |

### 服务项目（11个）
| 服务名称 | 价格 | 时长 | 分类 |
|----------|------|------|------|
| 快速洗车 | ¥20 | 20分钟 | 基础服务 |
| 基础洗车 | ¥30 | 30分钟 | 基础服务 |
| 标准洗车 | ¥35 | 35分钟 | 基础服务 |
| 精致洗车 | ¥50 | 45分钟 | 精致服务 |
| 高级洗车 | ¥55 | 50分钟 | 精致服务 |
| 豪华洗车 | ¥80 | 60分钟 | 豪华服务 |
| 至尊洗车 | ¥100 | 90分钟 | 豪华服务 |
| 内饰深度清洁 | ¥60 | 40分钟 | 专项服务 |
| 车身打蜡 | ¥40 | 30分钟 | 专项服务 |
| 发动机清洗 | ¥80 | 45分钟 | 专项服务 |
| 轮胎保养 | ¥45 | 25分钟 | 专项服务 |

### 时间段数据
- **时间范围：** 未来7天
- **每日时段：** 14个时间段
- **营业时间：** 09:00-18:00（中午12:00-14:00休息）
- **每时段容量：** 最多3个预约
- **总时段数：** 98个可预约时段

### 系统配置（13项）
- 网站基本信息
- 营业时间设置
- 预约规则配置
- 通知功能开关

## 数据备份

### 自动备份
使用 `reset-database-safe.bat` 会自动创建备份：
- **备份位置：** `backup/` 目录
- **文件命名：** `carwash_db_backup_YYYYMMDD_HHMMSS.sql`
- **备份内容：** 完整数据库结构和数据

### 手动备份
```bash
# 创建完整备份
mysqldump -u root -p123456 carwash_db > backup/manual_backup.sql

# 恢复备份
mysql -u root -p123456 carwash_db < backup/manual_backup.sql
```

## 注意事项

### ⚠️ 重要警告
1. **数据丢失：** 重置操作会永久删除所有现有数据
2. **不可逆：** 操作完成后无法撤销（除非有备份）
3. **业务影响：** 所有用户预约、反馈等数据将被清空

### 🔧 前置条件
1. **MySQL服务：** 确保MySQL服务正在运行
2. **数据库存在：** `carwash_db` 数据库必须已创建
3. **连接信息：** 确认数据库连接参数正确
   - 主机：localhost
   - 端口：3306
   - 用户名：root
   - 密码：123456

### 💡 最佳实践
1. **生产环境：** 生产环境请谨慎使用，建议先在测试环境验证
2. **定期备份：** 建议定期备份重要数据
3. **权限控制：** 确保只有授权人员可以执行重置操作
4. **测试验证：** 重置后应测试系统各功能是否正常

## 故障排除

### 常见错误及解决方案

#### 1. 连接失败
```
ERROR 2003: Can't connect to MySQL server
```
**解决方案：**
- 检查MySQL服务是否启动
- 确认端口3306是否开放
- 验证连接参数是否正确

#### 2. 权限不足
```
ERROR 1045: Access denied for user 'root'
```
**解决方案：**
- 检查用户名和密码
- 确认用户具有足够权限
- 尝试重新设置MySQL root密码

#### 3. 数据库不存在
```
ERROR 1049: Unknown database 'carwash_db'
```
**解决方案：**
- 先创建数据库：`CREATE DATABASE carwash_db;`
- 或运行初始化脚本：`sql/init.sql`

#### 4. 表不存在
```
ERROR 1146: Table 'carwash_db.users' doesn't exist
```
**解决方案：**
- 先运行表结构创建脚本：`sql/init.sql`
- 确保数据库表结构完整

## 联系支持
如遇到问题，请检查：
1. 系统日志文件
2. MySQL错误日志
3. 应用程序日志

---
*最后更新：2025-10-26*